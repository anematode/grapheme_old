var Grapheme=function(t){"use strict";function e(t){let e=0;for(let i=0;i<t.length;i++)if("("===t[i]?e++:")"===t[i]&&e--,e<0)return!1;return 0===e}function*i(t){if(!e(t))return void(yield-1);yield 0;let i,n,s=0;for(let e=0;e<t.length;e++){if("("===(i=t[e])?s++:")"===i&&s--,s<0)throw"Unbalanced parentheses at char "+e+".";if("("===i){if(e>=1){n="";let i=e-1;for(;i>=0&&x(t[i]);i--);if(e-i<=1)continue;yield{data:{type:0,value:n=t.slice(i+1,e)}}}}else if(")"===i)yield{data:{type:1}};else if("&"===i&&e>=1){n="";let i=e-1;for(;i>=0&&("("!==t[i]&&")"!==t[i]&&","!==t[i]);i--);if(e-i<=1)continue;yield{data:{type:2,value:n=t.slice(i+1,e)}}}}}function n(t){return c[t]?c[t]:p[t]?p[t]:d(t)?new u(+t):new o(t)}class s{constructor(t,e,i){this.type=t,this.execute=e,this.props=i||{}}evaluate(t){return this.execute(t)}}var a=(t,e)=>t+e,h=(t,e)=>t*e,r={NULL:new s("NULL",function(t){return NaN}),ADD:new s("ADD",function(t){return t.reduce(a)},{associative:!0,commutative:!0,distributive:!0}),MUL:new s("MUL",function(t){return t.reduce(h)},{associative:!0,commutative:!0,distributive:!0}),SUB:new s("SUB",function(t){return t[0]-t[1]}),DIV:new s("DIV",function(t){return t[0]/t[1]}),SIN:new s("SIN",function(t){return Math.sin(t[0])}),COS:new s("COS",function(t){return Math.cos(t[0])}),TAN:new s("TAN",function(t){return Math.tan(t[0])}),CSC:new s("CSC",function(t){return 1/Math.sin(t[0])}),SEC:new s("SEC",function(t){return 1/Math.cos(t[0])}),COT:new s("COT",function(t){return 1/Math.tan(t[0])}),SGN:new s("SGN",function(t){return Math.sign(t[0])}),POW:new s("EXP",function(t){return Math.pow(t[0],t[1])}),SQRT:new s("SQRT",function(t){return Math.sqrt(t[0])}),EXP:new s("EXP",function(t){return Math.exp(t[0])}),SQ:new s("SQ",function(t){return t[0]*t[0]})};class o{constructor(t){this.name=t,this.isVariable=!0}evaluate(t){return void 0!==t[this.name]?t[this.name]:0}is(t){return this.name===t.name}deepCopy(){return new o(this.name)}flatten(){return"x"===this.name||"y"===this.name?"["+this.name+"1,"+this.name+"2]":"vars."+this.name}}class u{constructor(t){this.value=+t,this.isConstant=!0}evaluate(){return this.value}equals(t){return this.value===t.value}close(t,e=1e-9){return Math.abs(this.value-t.value)<e}deepCopy(){return new u(this.value)}flatten(){return"["+this.value+","+this.value+"]"}}class l{constructor(t,e){this.name=t,this.value=e,this.isConstant=!0}evaluate(){return+this.value}equals(t){return this.value===t.value}close(t,e=1e-9){return Math.abs(this.value-t.value)<e}isConstant(){return!0}isVariable(){return!1}deepCopy(){return this}flatten(){return"["+this.value+","+this.value+"]"}}var c={PI:new l("PI",Math.PI),E:new l("E",Math.E)},p={x:new o("x"),y:new o("y")};class v{constructor(t,e,i){this.operator=t,this.tree=e,i?(this.parent=i,this.topNode=!1):this.topNode=!0,this.props={},this.isNode=!0}clearProps(){this.props={}}deepClearProps(){for(let t=0;t<this.tree.length;t++)this.tree[t].isNode&&this.tree[t].deepClearProps()}surfaceClearProps(){this.props={},this.topNode||this.parent.surfaceClearProps()}traverseBranches(t,e=!0){for(let i=0;i<this.tree.length;i++)this.tree[i].isNode&&(e||t(this),this.tree[i].traverseBranches(t,e),e&&t(this))}traverseNodesAsParent(t,e=!0){for(let i=0;i<this.tree.length;i++)e||t(this,i),this.tree[i].isNode&&this.tree[i].traverseNodesAsParent(t,e),e&&t(this,i)}fixParents(t){t&&(this.parent=t,this.topNode=!1);for(let t=0;t<this.tree.length;t++)this.tree[t].isNode&&this.tree[t].fixParents(this)}evaluate(t){return this.operator.evaluate(this.tree.map(e=>e.evaluate(t)))}deepCopy(){return new v(this.operator,this.tree.map(t=>t.deepCopy()),this.parent)}flatten(){return`Grapheme.Interval.${this.operator.type}(${this.tree.map(t=>t.flatten()).join(",")})`}hf(){return Function(this.flatten())}}var f=t=>r[t]?r[t]:r.NULL,d=t=>!isNaN(parseFloat(t)),x=function(t){let e=t.charCodeAt();return e>64&&e<91||e>96&&e<123},m=function(t,e=!0,i=!0){if(t.isNode){if(void 0!==t.props.isASTConstant)return t.props.isASTConstant;for(let n=0;n<t.tree.length;n++)if(!m(t.tree[n],i,i))return e&&(t.props.isASTConstant=!1),!1;return e&&(t.props.isASTConstant=!0),!0}return!!t.isConstant||(e&&t.isNode&&(t.props.isASTConstant=!1),!1)};class g{constructor(t){this.tree=[t]}traverseNodesAsParent(t,e=!0){for(let i=0;i<this.tree.length;i++)e||t(this,i),this.tree[i].isNode&&this.tree[i].traverseNodesAsParent(t,e),e&&t(this,i)}collapseConstants(t=!0){if(!t){let t=this.deepCopy();return t.traverseNodesAsParent(function(t,e){m(t.tree[e])&&(t.tree[e]=new u(t.tree[e].evaluate()))},!1),t}this.traverseNodesAsParent(function(t,e){m(t.tree[e])&&(t.tree[e]=new u(t.tree[e].evaluate()))},!1)}flatten(){return`let intervals = ${this.tree[0].flatten()};\n      for (let i = 0; i < intervals.length; i += 2) {\n        if (intervals[i] <= 0 && intervals[i + 1] >= 0) {\n          return true;\n        }\n      }\n      return false;`}compilehf(){return Function("x1","x2","y1","y2",this.flatten())}}class M{constructor(t,e){this.hf=t,this.graphingCtx=e,this.view=e.view,this.canvas=e.canvas,this.HEAP=new Float32Array(250),this.graphing=!1,this.cancelGraph=!1}asyncGraphRangeDFS(t,e,i,n,s=1,a,h=-1){this.graphing=!0;var r=this.HEAP,o=this.hf,u=this.view,l=Date.now(),c=this.view.minxd,p=this.view.minyd;let v,f,d,x,m,g,M,w;var y=h>=0?h:0;if(o(t,e,i,n))for(-1===h&&(r[0]=t,r[1]=e,r[2]=i,r[3]=n,y+=4);y>=4;){if(y<60&&Date.now()>l+1e3/60){if(this.cancelGraph)return void(this.cancelGraph=!1);var C=this;return void setTimeout(function(){u.xmin===t&&u.xmax===e&&u.ymin===i&&u.ymax===n?C.asyncGraphRangeDFS(t,e,i,n,s,a,h=y):C.graphing=!1},5)}x=r[y-1],d=r[y-2],f=r[y-3],o(v=r[y-4],f,d,x)?Math.abs(v-f)<s*c?Math.abs(d-x)<s*p?(m=u.pointXtoCanvasX(v),g=u.pointYtoCanvasY(d),M=Math.max(u.pointXtoCanvasX(f)-m,s/2,1),w=Math.max(u.pointYtoCanvasY(x)-g,s/2,1),this.graphingCtx.ctx.fillRect(m+.5,g+.5,M+.5,w+.5),y-=4):(r[y-=4]=v,r[y+1]=f,r[y+2]=d,r[y+3]=(d+x)/2,r[y+4]=v,r[y+5]=f,r[y+6]=(d+x)/2,r[y+7]=x,y+=8):Math.abs(d-x)<s*p?(r[y-=4]=v,r[y+1]=(v+f)/2,r[y+2]=d,r[y+3]=x,r[y+4]=(v+f)/2,r[y+5]=f,r[y+6]=d,r[y+7]=x,y+=8):(r[y-=4]=v,r[y+1]=(v+f)/2,r[y+2]=d,r[y+3]=(d+x)/2,r[y+4]=(v+f)/2,r[y+5]=f,r[y+6]=(d+x)/2,r[y+7]=x,r[y+8]=v,r[y+9]=(v+f)/2,r[y+10]=(d+x)/2,r[y+11]=x,r[y+12]=(v+f)/2,r[y+13]=f,r[y+14]=d,r[y+15]=(d+x)/2,y+=16):y-=4}this.graphing=!1,a&&a()}graph(t=1){this.asyncGraphRangeDFS(this.view.xmin,this.view.xmax,this.view.ymin,this.view.ymax,t)}cancelGraphing(){this.graphing&&(this.cancelGraph=!0)}}class w{constructor(t,e){this.hf=t,this.graphingCtx=e,this.view=e.view,this.canvas=e.canvas,this.HEAP=new Float32Array(250),this.graphing=!1,this.cancelGraph=!1}asyncGraphRangeDFS(t,e,i,n,s=1,a,h=-1){this.graphing=!0;var r=this.HEAP,o=this.hf,u=this.view,l=Date.now(),c=this.view.minxd,p=this.view.minyd;let v,f,d,x,m,g,M,w;var y=h>=0?h:0;if(o(t,e,i,n))for(-1===h&&(r[0]=t,r[1]=e,r[2]=i,r[3]=n,y+=4);y>=4;){if(y<60&&Date.now()>l+1e3/60){if(this.cancelGraph)return void(this.cancelGraph=!1);var C=this;return void setTimeout(function(){u.xmin===t&&u.xmax===e&&u.ymin===i&&u.ymax===n?C.asyncGraphRangeDFS(t,e,i,n,s,a,h=y):C.graphing=!1},5)}x=r[y-1],d=r[y-2],f=r[y-3],o(v=r[y-4],f,d,x)?Math.abs(v-f)<s*c?Math.abs(d-x)<s*p?(m=u.pointXtoCanvasX(v),g=u.pointYtoCanvasY(d),M=Math.max(u.pointXtoCanvasX(f)-m,s/2,1),w=Math.max(u.pointYtoCanvasY(x)-g,s/2,1),this.graphingCtx.ctx.fillRect(m+.5,g+.5,M+.5,w+.5),y-=4):(r[y-=4]=v,r[y+1]=f,r[y+2]=d,r[y+3]=(d+x)/2,r[y+4]=v,r[y+5]=f,r[y+6]=(d+x)/2,r[y+7]=x,y+=8):Math.abs(d-x)<s*p?(r[y-=4]=v,r[y+1]=(v+f)/2,r[y+2]=d,r[y+3]=x,r[y+4]=(v+f)/2,r[y+5]=f,r[y+6]=d,r[y+7]=x,y+=8):(r[y-=4]=v,r[y+1]=(v+f)/2,r[y+2]=d,r[y+3]=(d+x)/2,r[y+4]=(v+f)/2,r[y+5]=f,r[y+6]=(d+x)/2,r[y+7]=x,r[y+8]=v,r[y+9]=(v+f)/2,r[y+10]=(d+x)/2,r[y+11]=x,r[y+12]=(v+f)/2,r[y+13]=f,r[y+14]=d,r[y+15]=(d+x)/2,y+=16):y-=4}this.graphing=!1,a&&a()}graph(t=1){this.asyncGraphRangeDFS(this.view.xmin,this.view.xmax,this.view.ymin,this.view.ymax,t)}cancelGraphing(){this.graphing&&(this.cancelGraph=!0)}}class y{constructor(t,e,i,n,s){this.parentCanvas=t,this.xmin=e||-5,this.xmax=i||5,this.ymin=n||-5,this.ymax=s||5}copyFrom(t){if(!(t instanceof y))throw"Cannot copy from an object that is not an instance of ViewWindow";this.xmax=t.xmax,this.xmin=t.xmin,this.ymax=t.ymax,this.ymin=t.ymin}copyTo(t){if(!(t instanceof y))throw"Cannot copy to an object that is not an instance of ViewWindow";t.xmax=this.xmax,t.xmin=this.xmin,t.ymax=this.ymax,t.ymin=this.ymin}area(){return this.xdelta*this.ydelta}perimeter(){return 2*(this.xdelta+this.ydelta)}get WIDTH(){return this.parentCanvas.width}get HEIGHT(){return this.parentCanvas.height}get xdelta(){return this.xmax-this.xmin}get ydelta(){return this.ymax-this.ymin}translate(t,e,i=!1){i&&(t=this.scaleCanvasXtoPointX(t),e=this.scaleCanvasYtoPointY(e)),this.xmin+=t,this.xmax+=t,this.ymin+=e,this.ymax+=e}zoom(t,e,i,n=!1){n&&(t=this.canvasXtoPointX(t),e=this.canvasYtoPointY(e)),this.xmin=i*(this.xmin-t)+t,this.xmax=i*(this.xmax-t)+t,this.ymin=i*(this.ymin-e)+e,this.ymax=i*(this.ymax-e)+e}scaleCanvasXtoPointX(t){return-t*this.xdelta/this.WIDTH}scaleCanvasYtoPointY(t){return t*this.ydelta/this.HEIGHT}canvasXtoPointX(t){return t*this.xdelta/this.WIDTH+this.xmin}canvasYtoPointY(t){return(1-t/this.HEIGHT)*this.ydelta+this.ymin}pointXtoCanvasX(t){return this.WIDTH*(t-this.xmin)/this.xdelta}pointYtoCanvasY(t){return this.HEIGHT*(1-(t-this.ymin)/this.ydelta)}canvasPointToPoint(t,e){return[canvasXtoPointX(t),canvasYtoPointY(t)]}pointToCanvasPoint(t,e){return[pointXtoCanvasX(t),pointYtoCanvasY(t)]}get minxd(){return.5*(this.xmax-this.xmin)/this.parentCanvas.width}get minyd(){return.5*(this.ymax-this.ymin)/this.parentCanvas.height}}class C{constructor(t,e,i){this.canvas=t,this.ctx=e,this.functions=[],i?(this.angleThreshold=i.angleThreshold||.02,this.epsilon=i.epsilon||1e-6,this.density=i.density||400,this.view=i.view||new y(this.canvas,-5,5,-5,5)):(this.angleThreshold=.5,this.epsilon=1e-6,this.density=100,this.view=new y(this.canvas,-5,5,-5,5))}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}line(t,e,i,n){this.ctx.moveTo(this.view.pointXtoCanvasX(t),this.view.pointYtoCanvasY(e)),this.ctx.beginPath(),this.ctx.lineTo(this.view.pointXtoCanvasX(i),this.view.pointYtoCanvasY(n)),this.ctx.stroke()}graphPoint(t,e){this.ctx.beginPath(),this.ctx.arc(this.view.pointXtoCanvasX(t),this.view.pointYtoCanvasY(e),3,0,2*Math.PI),this.ctx.stroke()}graphLine(t,e,i,n,s=!0){this.ctx.beginPath(),s&&this.ctx.moveTo(this.view.pointXtoCanvasX(t),this.view.pointYtoCanvasY(e)),this.ctx.lineTo(this.view.pointXtoCanvasX(i),this.view.pointYtoCanvasY(n)),this.ctx.stroke()}graphAll(t=1){for(let e=0;e<this.functions.length;e++)this.functions[e].graph(t)}addEquation(t){t instanceof M?this.functions.push(t):t instanceof Function?this.functions.push(new M(t,this)):t instanceof g&&this.functions.push(new M(t.compilehf(),this))}cancelGraphing(){for(let t=0;t<this.functions.length;t++)this.functions[t].cancelGraphing()}}var P=t=>t*t,I={MUL:function(t,e){let i,n=[];for(let s=0;s<t.length;s+=2)for(let a=0;a<e.length;a+=2)i=Math.min(t[s]*e[a],t[s]*e[a+1],t[s+1]*e[a],t[s+1]*e[a+1]),n.push(i),i=Math.max(t[s]*e[a],t[s]*e[a+1],t[s+1]*e[a],t[s+1]*e[a+1]),n.push(i);return n},ADD:function(t,e){let i=[];for(let n=0;n<t.length;n+=2)for(let s=0;s<e.length;s+=2)i.push(t[n]+e[s]),i.push(t[n+1]+e[s+1]);return i},DIV:function(t){let e,i,n=[];for(let s=0;s<t.length;s+=2)0===t[s]&&0===t[s+1]||(t[s]<=0&&t[s+1]>=0?(n.push(-1/0),n.push(1/t[s]),n.push(1/t[s+1]),n.push(1/0)):(e=1/t[s+1],i=1/t[s],n.push(Math.min(e,i)),n.push(Math.max(e,i))));return n},SQ:function(t){let e=[];for(let i=0;i<t.length;i+=2)t[i]<=0&&t[i+1]>=0?(e.push(0),e.push(P(Math.max(Math.abs(t[i]),Math.abs(t[i+1]))))):(e.push(P(Math.min(Math.abs(t[i]),Math.abs(t[i+1])))),e.push(P(Math.max(Math.abs(t[i]),Math.abs(t[i+1])))));return e},ABS:function(t){let e=[];for(let i=0;i<t.length;i++)if(0===t[i]&&0===t[i+1])e.push(0),e.push(0);else{if(t[i]<=0&&t[i+1]>=0){e.push(0),e.push(Math.max(Math.abs(t[i]),Math.abs([i+1])));continue}e.push(Math.min(Math.abs(t[i]),Math.abs([i+1]))),e.push(Math.max(Math.abs(t[i]),Math.abs([i+1])))}return e},SGN:function(t){let e=[];for(let i=0;i<t.length;i++)t[i]<0&&(e.push(-1),e.push(-1)),t[i+1]>0&&(e.push(1),e.push(1)),t[i]<=0&&t[i+1]>=0&&(e.push(0),e.push(0));return e},SIN:function(t){let e,i,n=[];for(let s=0;s<t.length;s+=2)if(t[s+1]-t[s]>=2*Math.PI)n.push(-1),n.push(1);else if(e=2*Math.PI*Math.floor((t[s]+Math.PI/2)/(2*Math.PI))+3*Math.PI/2,i=2*Math.PI*Math.floor((t[s]+3*Math.PI/2)/(2*Math.PI))+Math.PI/2,t[s]<=e&&e<=t[s+1]){if(t[s]<=i&&i<=t[s+1]){n.push(-1),n.push(1);continue}n.push(-1),n.push(Math.max(Math.sin(t[s]),Math.sin(t[s+1])))}else{if(t[s]<=i&&i<=t[s+1]){n.push(Math.min(Math.sin(t[s]),Math.sin(t[s+1]))),n.push(1);continue}n.push(Math.min(Math.sin(t[s]),Math.sin(t[s+1]))),n.push(Math.max(Math.sin(t[s]),Math.sin(t[s+1])))}return n},COS:function(t){let e,i,n=[];for(let s=0;s<t.length;s+=2)if(t[s+1]-t[s]>=2*Math.PI)n.push(-1),n.push(1);else if(e=2*Math.PI*Math.floor((t[s]+Math.PI)/(2*Math.PI))+Math.PI,i=2*Math.PI*Math.floor(t[s]/(2*Math.PI))+2*Math.PI,t[s]<=e&&e<=t[s+1]){if(t[s]<=i&&i<=t[s+1]){n.push(-1),n.push(1);continue}n.push(-1),n.push(Math.max(Math.cos(t[s]),Math.cos(t[s+1])))}else{if(t[s]<=i&&i<=t[s+1]){n.push(Math.min(Math.cos(t[s]),Math.cos(t[s+1]))),n.push(1);continue}n.push(Math.min(Math.cos(t[s]),Math.cos(t[s+1]))),n.push(Math.max(Math.cos(t[s]),Math.cos(t[s+1])))}return n},TAN:function(t){let e,i=[];for(let n=0;n<t.length;n+=2)t[n+1]-t[n]>=Math.PI?(i.push(-1/0),i.push(1/0)):(e=Math.PI*Math.floor((t[n]+Math.PI/2)/Math.PI)+Math.PI/2,t[n]<=e&&e<=t[n+1]?(i.push(Math.tan(t[n])),i.push(1/0),i.push(-1/0),i.push(Math.tan(t[n+1]))):(i.push(Math.tan(t[n])),i.push(Math.tan(t[n+1]))));return i},CSC:function(t){}};class S{constructor(t,e){this.canvas=t,this.ctx=e||t.getContext("2d"),this.widgets=[],this.variables={},this.functions=[]}get width(){return this.canvas.width}get height(){return this.canvas.height}render(t=1e3/60){if(t){var e=Date.now();if(this.renderBackground(),Date.now()-e>t)return!1;for(let i=0;i<this.widgets.length;i++)if(this.widgets[i].render(),Date.now()-e>t)return!1;return!0}for(let t=0;t<this.widgets.length;t++)this.widgets[t].render()}get widgetCount(){return this.widgets.length}addWidget(t){t.setParent(this),this.widgets.push(t),this.updateWidgetIndices()}destroyWidget(t){t>=this.widgets.length||(this.widgets[t].destroyChildren(),this.widgets.splice(t,1),this.updateWidgetIndices())}updateWidgetIndices(){for(let t=0;t<this.widgets.length;t++)this.widgets[t].setParentIndex(t)}}class T{constructor(t,e,i,n,s,a){this.x=t,this.y=e,this.width=i,this.height=n,this.parent=s||null,this.parentIndex=void 0!==a?a:null}scale(t){this.width*=t,this.height*=t}translate(t,e){this.x+=t,this.y+=e}setParent(t){t instanceof S&&(this.parent=t)}setParentIndex(t){t>=0&&(this.parentIndex=t)}}class N extends T{constructor(t,e,i,n,s,a){super(t,e,i,n,s,a),this.testValue="udder"}method(t){return t*t}}return t.Operator=s,t.OPS=r,t.FunctionAST=g,t.ASTNode=v,t.isASTConstant=m,t.ASTConstantValue=function(t,e=!0,i=!0){if(m(t,e,i)){if(!e)return t.evaluate();if(e){let e=t.evaluate();return t.props.ASTConstantValue=e,e}}},t.ASTFromStringFunc=function(t){let e=[],a=i(t),h=a.next();if(-1===h)return null;for(;!(h=a.next()).done;)if(0===h.value.data.type)e.push(f(h.value.data.value));else if(1===h.value.data.type){let t=e.length-1;for(;t>=0&&!(e[t]instanceof s);t--);let i=new v(e[t],e.slice(t+1));e.splice(t),e.push(i)}else 2===h.value.data.type&&e.push(n(h.value.data.value));return 1!==e.length?null:(e[0].fixParents(),new g(e[0]))},t.GeneralEquation=M,t.GeneralInequality=w,t.ViewWindow=y,t.GraphingContext=C,t.Interval=I,t.GraphemeContext=S,t.Widget=T,t.TestWidget=N,t}({});
